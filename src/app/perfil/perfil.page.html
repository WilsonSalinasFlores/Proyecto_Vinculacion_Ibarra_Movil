<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>Mi Perfil</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="toggleEdit()" *ngIf="!isEditing">
        <ion-icon name="create-outline"></ion-icon>
        Editar
      </ion-button>
      <ion-button (click)="toggleEdit()" *ngIf="isEditing" color="medium">
        <ion-icon name="close-outline"></ion-icon>
        Cancelar  
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="profile-header">
    <ion-icon name="person-circle-outline" class="profile-photo" size="large"></ion-icon>
    <h2 class="profile-name">
      {{ profileForm.get('name')?.value }} {{ profileForm.get('lastname')?.value }}
    </h2>
    <p *ngIf="isEditing" class="edit-mode">Modo edición activado</p>
  </div>

  <ion-card class="profile-card">
    <ion-card-header>
      <ion-card-title>Información Personal</ion-card-title>
    </ion-card-header>
    
    <ion-card-content>
      <form [formGroup]="profileForm" class="profile-form">
        
        <!-- Campos de solo lectura -->
        <ion-item lines="full">
          <ion-icon slot="start" name="person-outline"></ion-icon>
          <ion-label position="stacked">Nombres</ion-label>
          <ion-input formControlName="name" readonly></ion-input>
        </ion-item>

        <ion-item lines="full">
          <ion-icon slot="start" name="people-outline"></ion-icon>
          <ion-label position="stacked">Apellidos</ion-label>
          <ion-input formControlName="lastname" readonly></ion-input>
        </ion-item>

        <!-- Campos editables -->
        <ion-item lines="full">
          <ion-icon slot="start" name="mail-outline"></ion-icon>
          <ion-label position="stacked">Correo electrónico *</ion-label>
          <ion-input type="email" formControlName="email"></ion-input>
        </ion-item>
        <ion-note *ngIf="profileForm.get('email')?.invalid && profileForm.get('email')?.touched" color="danger">
          Email inválido
        </ion-note>

        <ion-item lines="full">
          <ion-icon slot="start" name="call-outline"></ion-icon>
          <ion-label position="stacked">Teléfono</ion-label>
          <ion-input type="tel" formControlName="phone"></ion-input>
        </ion-item>

        <ion-item lines="full">
          <ion-icon slot="start" name="location-outline"></ion-icon>
          <ion-label position="stacked">Dirección</ion-label>
          <ion-input formControlName="address"></ion-input>
        </ion-item>

        <ion-item lines="full">
          <ion-icon slot="start" name="person-circle"></ion-icon>
          <ion-label position="stacked">Usuario *</ion-label>
          <ion-input formControlName="username"></ion-input>
        </ion-item>
        <ion-note *ngIf="profileForm.get('username')?.invalid && profileForm.get('username')?.touched" color="danger">
          Usuario requerido
        </ion-note>

      </form>
    </ion-card-content>
  </ion-card>

  <!-- Botones de acción -->
  <div class="action-buttons" *ngIf="isEditing">
    <ion-button expand="block" color="primary" (click)="saveProfile()" 
                [disabled]="profileForm.invalid" class="save-button">
      <ion-icon slot="start" name="save-outline"></ion-icon>
      Guardar Cambios
    </ion-button>
    
    <ion-button expand="block" color="medium" (click)="toggleEdit()" class="cancel-button">
      <ion-icon slot="start" name="close-outline"></ion-icon>
      Cancelar
    </ion-button>
  </div>

</ion-content>